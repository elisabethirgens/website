extends ../layouts/default

mixin post(post, category)
  each cats in post.categories
    if !category || category === cats.key
      - n++

      if n < 4
        post(data-ks-editable=editable(user, { list: 'Post', id: post.id }))
          if n == 1 || n == 3
            .col-md-12
              .animatedParent
                h2.text-center.animated.fadeIn= post.title
              .col-md-7.animatedParent
                .animated.fadeIn(data-0="left: -100px;", data-1100="left: 0px;", style="position: relative")
                  p.lead.text-muted Posted
                    if post.publishedDate
                      | on #{post._.publishedDate.format('MMMM Do, YYYY')} 
                    if post.categories && post.categories.length
                      | in 
                      each cat, i in post.categories
                        if i < post.categories.length - 1
                          | , 
                        else
                          |  
                  p!= post.content.brief
                    if post.author
                      | by #{post.author.name.first}
                  a(href='/portfolio/' + post.slug) Les mer.

              if post.image.exists
                img(src=post._.image.fit(400,400), data-0="left: 0px;", data-1100="left: -100px;", style="position: relative").img
              
          if n == 2
            .col-md-12
              if post.image.exists
                .animatedParent
                  h2.text-center.animated.fadeIn= post.title

                .col-md-5.animatedParent
                  img(src=post._.image.fit(400,400), data-0="top: 0px;", data-1600="top: -120px;", style="position: relative").img.animated.fadeIn
                .col-md-7.animatedParent
                  .animated.fadeIn
                    p.animated.fadeIn!= post.content.brief
                      if post.content.extended
                    a(href='/portfolio/' + post.slug) Les mer.
      else 
        post(data-ks-editable=editable(user, { list: 'Post', id: post.id }))
          if n == 4
            .col-md-12
              .animatedParent
                if norwegian
                  h2.text-center.animated.fadeIn Tidligere løsninger fra oss
                else
                  h2.text-center.animated.fadeIn Earlier projects
          .col-md-4.animatedParent
            .animated.fadeIn
              h4.text-center: a(href='/news/post/' + post.slug)= post.title
              p.lead.text-muted Posted
                if post.publishedDate
                  | on #{post._.publishedDate.format('MMMM Do, YYYY')} 
                if post.categories && post.categories.length
                  | in 
                  each cat, i in post.categories
                    a(href='/news/' + cat.key)= cat.name
                    if i < post.categories.length - 1
                      | , 
                    else
                      |  
                    
                if post.author
                  | by #{post.author.name.first}
              if post.image.exists
                img(src=post._.image.fit(300,300)).img
              p!= post.content.brief
              if post.content.extended
                p.read-more: a(href='/news/post/' + post.slug) Read more...
block intro
  .container.portfolio
    if norwegian
      h1 Løsninger
    else 
      h1 Solutions

block content
  .container: .row
      if filters.category && !data.category
        h3.text-muted Invalid Category.
      else
        if data.posts.results.length

          .portfolio
            - var n = 0;
            each post in data.posts.results
              +post(post, 'portfolio')

          if data.posts.totalPages > 1
            ul.pagination
              if data.posts.previous
                li: a(href='?page=' + data.posts.previous): span.glyphicon.glyphicon-chevron-left
              else
                li.disabled: a(href='?page=' + 1): span.glyphicon.glyphicon-chevron-left
              each p, i in data.posts.pages
                li(class=data.posts.currentPage == p ? 'active' : null)
                  a(href='?page=' + (p == '...' ? (i ? data.posts.totalPages : 1) : p ))= p
              if data.posts.next
                li: a(href='?page=' + data.posts.next): span.glyphicon.glyphicon-chevron-right
              else
                li.disabled: a(href='?page=' + data.posts.totalPages): span.entypo.glyphicon.glyphicon-chevron-right
        else
          if data.category
            h3.text-muted There are no posts in the category #{data.category.name}.
          else
            h3.text-muted There are no posts yet.